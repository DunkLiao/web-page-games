<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è²“èˆ‡é¼ ï¼šè—è¡“å¤§å†’éšª</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;900&display=swap" rel="stylesheet">
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #2d3436;
            font-family: 'Noto Sans TC', sans-serif;
            touch-action: none;
        }
        canvas {
            display: block;
            cursor: none;
        }
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
        }
        .game-title {
            background: linear-gradient(135deg, #ff9f43, #ee5253);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .btn-gradient {
            background: linear-gradient(135deg, #ff9f43, #ee5253);
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .btn-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(238, 82, 83, 0.3);
        }
        .btn-secondary {
            background: rgba(255, 255, 255, 0.8);
            transition: all 0.2s;
        }
        .btn-secondary:active {
            transform: scale(0.9);
            background: rgba(255, 255, 255, 1);
        }
        /* è‡ªå®šç¾© Slider æ¨£å¼ */
        input[type=range] {
            accent-color: #ff9f43;
        }
    </style>
</head>
<body class="flex items-center justify-center h-screen">

    <!-- UI æ§åˆ¶å±¤ -->
    <div class="fixed top-6 left-6 flex flex-col gap-4 pointer-events-none z-10">
        <!-- åˆ†æ•¸é¡¯ç¤º -->
        <div class="glass p-4 shadow-xl flex items-center gap-4">
            <div class="w-10 h-10 rounded-full bg-orange-100 flex items-center justify-center text-xl">ğŸ†</div>
            <div>
                <div class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Score</div>
                <div id="scoreLabel" class="text-2xl font-black text-slate-800">0</div>
            </div>
        </div>
        <!-- æ™‚é–“é¡¯ç¤º -->
        <div class="glass p-4 shadow-xl flex items-center gap-4">
            <div class="w-10 h-10 rounded-full bg-blue-100 flex items-center justify-center text-xl">â³</div>
            <div>
                <div class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Time</div>
                <div id="timerLabel" class="text-2xl font-black text-slate-800">30s</div>
            </div>
        </div>
        <!-- é‡æ–°é–‹å§‹æŒ‰éˆ• (åƒ…åœ¨éŠæˆ²ä¸­é¡¯ç¤º) -->
        <button id="inGameResetBtn" class="glass p-4 shadow-xl flex items-center gap-4 pointer-events-auto btn-secondary opacity-0 transition-opacity duration-300">
            <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center text-xl">ğŸ </div>
            <div class="text-left">
                <div class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Menu</div>
                <div class="text-sm font-black text-slate-800">è¿”å›é¸å–®</div>
            </div>
        </button>
    </div>

    <!-- é¸å–®ä»‹é¢ -->
    <div id="menuOverlay" class="fixed inset-0 bg-slate-900/40 backdrop-blur-md flex items-center justify-center z-50 p-6">
        <div class="bg-white/90 p-8 rounded-[40px] shadow-2xl max-w-sm w-full text-center border border-white/50">
            <div class="text-5xl mb-3">ğŸ±</div>
            <h1 id="menuTitle" class="text-3xl font-black game-title mb-1">è—è¡“å¤§å†’éšª</h1>
            <p id="menuDesc" class="text-slate-500 text-sm mb-6 leading-relaxed">åœ¨éœè¬çš„åˆå¾Œè‰åªä¸Šå±•é–‹è¿½é€ã€‚</p>
            
            <!-- è¨­å®šå€å¡Š -->
            <div class="space-y-4 mb-8 bg-white/50 p-5 rounded-3xl border border-slate-100 text-left">
                <div class="flex flex-col gap-2">
                    <div class="flex justify-between text-xs font-bold text-slate-600">
                        <span>éŠæˆ²æ™‚é–“</span>
                        <span id="timeValue">30s</span>
                    </div>
                    <input type="range" id="timeSetting" min="10" max="120" step="10" value="30" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                </div>
                <div class="flex flex-col gap-2">
                    <div class="flex justify-between text-xs font-bold text-slate-600">
                        <span>è€é¼ æ•¸é‡</span>
                        <span id="mouseValue">1</span>
                    </div>
                    <input type="range" id="mouseSetting" min="1" max="10" step="1" value="1" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                </div>
            </div>

            <div id="finalScoreArea" class="hidden mb-6 p-4 bg-orange-50 rounded-2xl">
                <p class="text-slate-400 text-[10px] font-bold uppercase mb-1">æœ€å¾Œæ•ç²</p>
                <p id="finalScore" class="text-5xl font-black text-orange-500">0</p>
            </div>

            <button id="startBtn" class="btn-gradient w-full text-white font-bold py-4 rounded-2xl text-lg shadow-lg">
                é–‹å§‹éŠæˆ²
            </button>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreLabel = document.getElementById('scoreLabel');
        const timerLabel = document.getElementById('timerLabel');
        const menuOverlay = document.getElementById('menuOverlay');
        const menuTitle = document.getElementById('menuTitle');
        const menuDesc = document.getElementById('menuDesc');
        const finalScoreArea = document.getElementById('finalScoreArea');
        const finalScore = document.getElementById('finalScore');
        const startBtn = document.getElementById('startBtn');
        const inGameResetBtn = document.getElementById('inGameResetBtn');
        
        // è¨­å®šçµ„ä»¶
        const timeSetting = document.getElementById('timeSetting');
        const mouseSetting = document.getElementById('mouseSetting');
        const timeValueDisplay = document.getElementById('timeValue');
        const mouseValueDisplay = document.getElementById('mouseValue');

        // æ›´æ–°è¨­å®šæ•¸å€¼é¡¯ç¤º
        timeSetting.oninput = () => timeValueDisplay.innerText = `${timeSetting.value}s`;
        mouseSetting.oninput = () => mouseValueDisplay.innerText = mouseSetting.value;

        let score = 0;
        let timeLeft = 30;
        let isPlaying = false;
        let animationId;
        let timerId;
        let mice = [];
        let particles = [];

        class Particle {
            constructor(x, y, color, size, vx, vy, life) {
                this.x = x; this.y = y; this.color = color;
                this.size = size; this.vx = vx; this.vy = vy;
                this.life = life; this.maxLife = life;
            }
            draw() {
                ctx.globalAlpha = this.life / this.maxLife;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.globalAlpha = 1;
            }
            update() {
                this.x += this.vx; this.y += this.vy;
                this.life--;
            }
        }

        class Mouse {
            constructor() {
                this.size = 45;
                this.reset();
            }
            reset() {
                const margin = 100;
                this.x = margin + Math.random() * (canvas.width - margin * 2);
                this.y = margin + Math.random() * (canvas.height - margin * 2);
                const baseSpeed = 4 + (score * 0.05); // ç¨å¾®é™ä½é€Ÿåº¦å¢é•·ï¼Œå¤šé¼ æ¨¡å¼ä¸‹å¹³è¡¡æ€§è¼ƒå¥½
                const angle = Math.random() * Math.PI * 2;
                this.vx = Math.cos(angle) * baseSpeed;
                this.vy = Math.sin(angle) * baseSpeed;
                this.pulse = 1;
            }
            update() {
                this.x += this.vx;
                this.y += this.vy;
                if (this.x < this.size/2 || this.x > canvas.width - this.size/2) this.vx *= -1;
                if (this.y < this.size/2 || this.y > canvas.height - this.size/2) this.vy *= -1;
                this.pulse = 1 + Math.sin(Date.now() * 0.01) * 0.05;
            }
            draw() {
                ctx.save();
                ctx.translate(this.x, this.y);
                ctx.scale(this.pulse, this.pulse);
                if (this.vx < 0) ctx.scale(-1, 1);
                ctx.font = `${this.size}px Arial`;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.shadowBlur = 10;
                ctx.shadowColor = 'rgba(0,0,0,0.1)';
                ctx.fillText('ğŸ­', 0, 0);
                ctx.restore();
            }
        }

        const cat = {
            x: 0, y: 0, size: 70, speed: 8,
            targetX: null, targetY: null,
            angle: 0, scale: 1, tilt: 0
        };

        let grassTufts = [];
        function initBackground() {
            grassTufts = [];
            for(let i=0; i<30; i++) {
                grassTufts.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    size: 10 + Math.random() * 20,
                    alpha: 0.1 + Math.random() * 0.2
                });
            }
        }

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            initBackground();
            if (!isPlaying) {
                cat.x = canvas.width / 2;
                cat.y = canvas.height / 2;
            }
        }

        window.addEventListener('resize', resize);
        resize();

        const keys = {};
        window.addEventListener('keydown', e => keys[e.code] = true);
        window.addEventListener('keyup', e => keys[e.code] = false);

        function handlePointer(e) {
            if (!isPlaying) return;
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            cat.targetX = clientX;
            cat.targetY = clientY;
        }

        canvas.addEventListener('mousedown', handlePointer);
        canvas.addEventListener('mousemove', e => { if (e.buttons > 0) handlePointer(e); });
        canvas.addEventListener('touchstart', handlePointer);
        canvas.addEventListener('touchmove', handlePointer);

        function createExplosion(x, y, color) {
            for(let i=0; i<15; i++) {
                particles.push(new Particle(x, y, color, Math.random() * 5 + 2, (Math.random() - 0.5) * 10, (Math.random() - 0.5) * 10, 30 + Math.random() * 20));
            }
        }

        function update() {
            if (!isPlaying) return;

            let moveX = 0, moveY = 0;
            if (keys['ArrowUp'] || keys['KeyW']) moveY -= cat.speed;
            if (keys['ArrowDown'] || keys['KeyS']) moveY += cat.speed;
            if (keys['ArrowLeft'] || keys['KeyA']) moveX -= cat.speed;
            if (keys['ArrowRight'] || keys['KeyD']) moveX += cat.speed;

            if (cat.targetX !== null) {
                const dx = cat.targetX - cat.x;
                const dy = cat.targetY - cat.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                if (dist > 5) {
                    moveX = (dx / dist) * cat.speed;
                    moveY = (dy / dist) * cat.speed;
                } else {
                    cat.targetX = null; cat.targetY = null;
                }
            }

            if (moveX !== 0 || moveY !== 0) {
                cat.x += moveX;
                cat.y += moveY;
                if (Math.random() > 0.7) particles.push(new Particle(cat.x, cat.y + 20, '#e2e8f0', 4, -moveX*0.2, -2, 20));
            }

            cat.x = Math.max(cat.size/2, Math.min(canvas.width - cat.size/2, cat.x));
            cat.y = Math.max(cat.size/2, Math.min(canvas.height - cat.size/2, cat.y));
            cat.tilt = Math.sin(Date.now() * 0.01) * 0.1;
            cat.scale = 1 + Math.sin(Date.now() * 0.005) * 0.02;

            mice.forEach(m => m.update());
            particles.forEach((p, i) => {
                p.update();
                if (p.life <= 0) particles.splice(i, 1);
            });

            mice.forEach(m => {
                const dist = Math.sqrt((cat.x - m.x)**2 + (cat.y - m.y)**2);
                if (dist < (cat.size + m.size) * 0.4) {
                    score++;
                    scoreLabel.innerText = score;
                    createExplosion(m.x, m.y, '#ff9f43');
                    m.reset();
                }
            });
        }

        function draw() {
            const bgGrad = ctx.createRadialGradient(canvas.width/2, canvas.height/2, 0, canvas.width/2, canvas.height/2, canvas.width);
            bgGrad.addColorStop(0, '#f0fff4');
            bgGrad.addColorStop(1, '#d7f3e3');
            ctx.fillStyle = bgGrad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            grassTufts.forEach(g => {
                ctx.fillStyle = '#27ae60';
                ctx.globalAlpha = g.alpha;
                ctx.font = `${g.size}px Arial`;
                ctx.fillText('ğŸŒ¿', g.x, g.y);
            });
            ctx.globalAlpha = 1;

            particles.forEach(p => p.draw());
            mice.forEach(m => m.draw());

            ctx.save();
            ctx.translate(cat.x, cat.y);
            ctx.rotate(cat.tilt);
            ctx.scale(cat.scale, cat.scale);
            let isMovingLeft = (keys['ArrowLeft'] || keys['KeyA'] || (cat.targetX && cat.targetX < cat.x));
            if (isMovingLeft) ctx.scale(-1, 1);
            ctx.font = `${cat.size}px Arial`;
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.shadowBlur = 15;
            ctx.shadowColor = 'rgba(0,0,0,0.15)';
            ctx.fillText('ğŸ±', 0, 0);
            ctx.restore();

            if (isPlaying) {
                animationId = requestAnimationFrame(() => {
                    update();
                    draw();
                });
            }
        }

        function startGame() {
            score = 0;
            timeLeft = parseInt(timeSetting.value);
            const mouseCount = parseInt(mouseSetting.value);
            
            isPlaying = true;
            particles = [];
            mice = Array.from({ length: mouseCount }, () => new Mouse());
            
            scoreLabel.innerText = score;
            timerLabel.innerText = `${timeLeft}s`;
            menuOverlay.classList.add('hidden');
            finalScoreArea.classList.add('hidden');
            inGameResetBtn.classList.replace('opacity-0', 'opacity-100');
            
            cat.x = canvas.width / 2;
            cat.y = canvas.height / 2;
            cat.targetX = null; cat.targetY = null;
            
            draw();

            timerId = setInterval(() => {
                timeLeft--;
                timerLabel.innerText = `${timeLeft}s`;
                if (timeLeft <= 0) endGame();
            }, 1000);
        }

        function endGame() {
            isPlaying = false;
            clearInterval(timerId);
            cancelAnimationFrame(animationId);
            
            inGameResetBtn.classList.replace('opacity-100', 'opacity-0');
            
            menuTitle.innerText = "è¿½é€çµæŸ";
            menuDesc.innerText = "é€™å ´å†’éšªéå¸¸ç²¾å½©ï¼";
            finalScore.innerText = score;
            finalScoreArea.classList.remove('hidden');
            startBtn.innerText = "å†æ¬¡æŒ‘æˆ°";
            menuOverlay.classList.remove('hidden');
        }

        // é‡æ–°éŠæˆ²/è¿”å›é¸å–®åŠŸèƒ½
        function resetToMenu() {
            isPlaying = false;
            clearInterval(timerId);
            cancelAnimationFrame(animationId);
            
            inGameResetBtn.classList.replace('opacity-100', 'opacity-0');
            
            menuTitle.innerText = "è—è¡“å¤§å†’éšª";
            menuDesc.innerText = "é‡æ–°èª¿æ•´ä½ çš„æŒ‘æˆ°è¨­å®šå§ï¼";
            finalScoreArea.classList.add('hidden');
            startBtn.innerText = "é‡æ–°é–‹å§‹";
            menuOverlay.classList.remove('hidden');
        }

        startBtn.addEventListener('click', startGame);
        inGameResetBtn.addEventListener('click', resetToMenu);

    </script>
</body>
</html>